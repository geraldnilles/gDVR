<html>
<head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script>

var uid = "";
var status_id = 0;

function sync_get(x){
	return $.get(x);
}

function get_status(){
	// Reads the status of the stream
	// Will either return idle, preparing, or ready
	// Idle means the tuner aint doing shit
	// Preparing means the tuner has started, but is not ready to stream
	// Ready means the stream is ready to roll
	var s = sync_get("/streamer/status");

	return s;
}

// Changes the channel and starts the streamer
function change_channel(channel){
	// Stop Video Player
	var ret = sync_get("/streamer/watch/"+channel);

	// Start Status Loop with 2s interval
	status_id = setInterval(status_loop,2000);
}

// Stops the streamer
function stop(){
	var ret = sync_get("/streamer/stop");
	// Stop The Status Loop
	clearInterval(status_is);
	status_id = setInterval(status_loop,10000);
}


// Status Loop
//
// This function will regularly poll the status of the streamer at a regular
// interval.  If ready
function status_loop(){
	var s = get_status();
	if (s=="ready"){
		// Start the video is it is not started already
		var video = document.getElementsByTagName("video")[0];
		if(video.paused == true){
			video.pasued = false;
		}
		// Reduce Status Interval to 10s
		clearInterval(status_id);
		status_id = setInterval(status_loop,10000);
	}else{
		// Print "Tuner is 's'" somewhere on the page	
		display_status(s)
	}
}

function display_status(s){
	var sts = document.getElementById("status");
	sts.innerHTML = s;
}

function ready(){
	status_id = setInterval(status_loop,10000);
}

</script>

</head>
<body onload="ready();" >

	<h2>Live TV!</h2>

	<div id="status">
		The Tuner is available.  Click Here to take control
	</div>

	<div>
		Choose a channel to watch
	<select>
		<option value="681">ESPN</option>
		<option value="111">FX</option>
		<option value="123">E!</option>
	</select>
	</div>

	<video controls src="/live/out.m3u8"></video>

</body>

</html>

